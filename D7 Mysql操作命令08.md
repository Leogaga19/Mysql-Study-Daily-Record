# 标量子查询
**标量子查询**“标量”就是“单一”的意思。其限制是：必须并且仅能返回1行1列的结果，也就是返回单一值的子查询。  
应用：**标量子查询**可以应用在任何使用**单一值**的地方，就是说**可以使用常数或列明的地方，无论是SELECT子句，GROUP BY子句，HAVING子句，还是ORDER BY子句
几乎所有的地方都可以使用。  
问题：查询按商品种类计算出的销售单价高于全部商品单价的商品种类。  
解答如下：
```
mysql> SELECT type, AVG(sprice)
    -> FROM pro
    -> GROUP BY type
    -> HAVING AVG(sprice) > (SELECT AVG(sprice) FROM pro);
+--------------+-------------+
| type         | AVG(sprice) |
+--------------+-------------+
| 衣服         |   2500.0000 |
| 厨房用具     |   2795.0000 |
+--------------+-------------+
2 rows in set (0.19 sec)
```

# 关联子查询
问题：参照pro表格，创建包含id,name,type,sprice和不同种类商品平均价格（average price of TPYE products）的视图。
**pro表格数据如下：**
```
mysql> SELECT * FROM pro;
+------+------------+--------------+--------+--------+------------+
| id   | name       | type         | sprice | pprice | rd         |
+------+------------+--------------+--------+--------+------------+
| 0001 | T恤衫      | 衣服         |   1000 |    500 | 2009-09-20 |
| 0002 | 打孔器     | 办公用品     |    500 |    320 | 2009-09-11 |
| 0003 | 运动T恤    | 衣服         |   4000 |   2800 | NULL       |
| 0004 | 菜刀       | 厨房用具     |   3000 |   2800 | 2009-09-20 |
| 0005 | 高压锅     | 厨房用具     |   6800 |   5000 | 2009-01-15 |
| 0006 | 叉子       | 厨房用具     |    500 |   NULL | 2009-09-20 |
| 0007 | 擦菜板     | 厨房用具     |    880 |    790 | 2008-04-28 |
| 0008 | 圆珠笔     | 办公用品     |    100 |   NULL | 2009-11-11 |
+------+------------+--------------+--------+--------+------------+
8 rows in set (0.00 sec)
```
则解答如下：
```
mysql> CREATE VIEW apbt
    -> AS
    -> SELECT id, name, type, sprice,
    -> (SELECT AVG(sprice) FROM  pro             #关联子查询
    -> AS P2                                         
    -> WHERE P1.type = P2.type                   #WHERE语句非常关键，限定了P1和P2表格中的商品种类一致，是的AVG函数按照商品种类进行均值计算
    -> GROUP BY type) AS asp                     #此处的GROUP BY type也可以省略，查询结果一致！
    -> FROM pro
    -> AS P1;
Query OK, 0 rows affected (0.19 sec)

mysql> SELECT * FROM apbt;
+------+------------+--------------+--------+-----------+
| id   | name       | type         | sprice | asp       |
+------+------------+--------------+--------+-----------+
| 0001 | T恤衫      | 衣服         |   1000 | 2500.0000 |
| 0002 | 打孔器     | 办公用品     |    500 |  300.0000 |
| 0003 | 运动T恤    | 衣服         |   4000 | 2500.0000 |
| 0004 | 菜刀       | 厨房用具     |   3000 | 2795.0000 |
| 0005 | 高压锅     | 厨房用具     |   6800 | 2795.0000 |
| 0006 | 叉子       | 厨房用具     |    500 | 2795.0000 |
| 0007 | 擦菜板     | 厨房用具     |    880 | 2795.0000 |
| 0008 | 圆珠笔     | 办公用品     |    100 |  300.0000 |
+------+------------+--------------+--------+-----------+
8 rows in set (0.00 sec)
```
