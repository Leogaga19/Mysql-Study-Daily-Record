# MySQL操作指令06
学习参考资料：[SQL基础教程(第2版)](http://www.ituring.com.cn/book/1880)

**学习用表**
```
mysql> SELECT * FROM pro;
+------+------------+--------------+--------+--------+------------+
| id   | name       | type         | sprice | pprice | rd         |
+------+------------+--------------+--------+--------+------------+
| 0001 | T恤衫      | 衣服         |   1000 |     50 | 2009-09-20 |
| 0002 | 打孔器     | 办公用品     |    500 |    320 | 2009-09-11 |
| 0003 | 运动T恤    | 衣服         |   4000 |   2800 | 2009-09-20 |
| 0004 | 菜刀       | 厨房用具     |   3000 |   2800 | 2009-09-20 |
| 0005 | 高压锅     | 厨房用具     |   6800 |   5000 | 2009-01-15 |
| 0006 | 叉子       | 厨房用具     |    500 |   NULL | 2009-09-20 |
| 0007 | 擦菜板     | 厨房用具     |    880 |    790 | 2008-04-28 |
| 0008 | 圆珠笔     | 办公用品     |    100 |   NULL | 2009-11-11 |
+------+------------+--------------+--------+--------+------------+
8 rows in set (0.00 sec)
```
## 1.Mysql的逻辑操作符AND/OR/NOT
场景：挑选出办公用品并且登记日期是2009-9-20或2009-9-11的商品。
```
mysql> SELECT name, type, rd FROM pro
    -> WHERE type = '办公用品'
    -> AND rd = '2009-09-11'
    -> OR rd = '2009-09-20';
+------------+--------------+------------+
| name       | type         | rd         |
+------------+--------------+------------+
| T恤衫      | 衣服         | 2009-09-20 |
| 打孔器     | 办公用品     | 2009-09-11 |
| 运动T恤    | 衣服         | 2009-09-20 |
| 菜刀       | 厨房用具     | 2009-09-20 |
| 叉子       | 厨房用具     | 2009-09-20 |
+------------+--------------+------------+
5 rows in set (0.00 sec)

mysql> SELECT name, type, rd FROM pro
    -> WHERE type = '办公用品'
    -> AND (rd = '2009-09-11'                  #通过括号提高运算优先级！
    -> OR rd = '2009-09-20');
+-----------+--------------+------------+
| name      | type         | rd         |
+-----------+--------------+------------+
| 打孔器    | 办公用品     | 2009-09-11 |
+-----------+--------------+------------+
1 row in set (0.00 sec)
```
第一次命令无法选择出指定用品是因为**AND的优先级比OR要高**，所以第一次选出的是“办公用品且登记日期2009-09-11的商品或登记日期2009-09-20的商品”  
第二次用**括号()**提高了OR的优先级才成功取出目标数据。

## 2.MySQL中对表进行聚合查询
SQL中常用的5个函数：  
**COUNT**：技术表中的记录数量（行数）；  
**SUM**：计算表中数值列中数据的和；  
**AVG**：对表中的数值列求均值；  
**MAX**：搜寻表中任意列中的最大值；  
**MIN**：搜寻表中任意列中的最小值。

示例：
```
mysql> SELECT COUNT(pprice) FROM pro;     #查询pprice字段有多少数据，默认不统计Value Is Null的数据。
+---------------+
| COUNT(pprice) |
+---------------+
|             6 |
+---------------+
1 row in set (0.00 sec)

mysql> SELECT COUNT(*), COUNT(pprice) FROM pro;        #COUNT(*)统计含Value Is Null的数据。
+----------+---------------+
| COUNT(*) | COUNT(pprice) |
+----------+---------------+
|        8 |             6 |
+----------+---------------+
1 row in set (0.00 sec)

mysql> SELECT SUM(pprice) FROM pro;                    #计算pprice数值列的汇总值，仅对数值列可以使用SUM函数！
+-------------+
| SUM(pprice) |
+-------------+
|       11760 |
+-------------+
1 row in set (0.00 sec)

mysql> SELECT AVG(pprice) FROM pro;                     #查询并计算pprice数值列的平均值，仅对数值列可以使用AVG函数！
+-------------+
| AVG(pprice) |
+-------------+
|   1960.0000 |
+-------------+
1 row in set (0.00 sec)

mysql> SELECT COUNT(pprice), AVG(pprice) FROM pro;
+---------------+-------------+
| COUNT(pprice) | AVG(pprice) |
+---------------+-------------+
|             6 |   1960.0000 |
+---------------+-------------+
1 row in set (0.00 sec)

mysql> SELECT MAX(rd), MAX(pprice) FROM pro;            #查询并计算rd（登记日期）和pprice（采购价格）的最大值，MAX基本对各种值均可采用！
+------------+-------------+
| MAX(rd)    | MAX(pprice) |
+------------+-------------+
| 2009-11-11 |        5000 |
+------------+-------------+
1 row in set (0.00 sec)

mysql> SELECT COUNT( DISTINCT type) FROM pro;           #查询并计算type共有多少不同的种类。
+-----------------------+
| COUNT( DISTINCT type) |
+-----------------------+
|                     3 |
+-----------------------+
1 row in set (0.00 sec)
```
## 3.MySQL中对表进行分组
CHAP 3-2 P91 **子句书写顺序：SELECT-->FROM-->WHERE-->GROUP BY**
**分组命令：**  
```
SELECT <列名1>, <列名2>, <列名3>,……
FROM tb_name
[WHERE CLAUSE]
GROUP BY <列名1>, <列名2>, <列名3>……；
```
### 3.1常规分组 示例：
```
mysql> SELECT  type, COUNT(type) FROM pro
    -> GROUP BY type;
+--------------+-------------+
| type         | COUNT(type) |
+--------------+-------------+
| 衣服         |           2 |
| 办公用品     |           2 |
| 厨房用具     |           4 |
+--------------+-------------+
3 rows in set (0.00 sec)

mysql> SELECT  type FROM pro
    -> GROUP BY type;
+--------------+
| type         |
+--------------+
| 衣服         |
| 办公用品     |
| 厨房用具     |
+--------------+
3 rows in set (0.00 sec)

mysql> SELECT  type FROM pro;
+--------------+
| type         |
+--------------+
| 衣服         |
| 办公用品     |
| 衣服         |
| 厨房用具     |
| 厨房用具     |
| 厨房用具     |
| 厨房用具     |
| 办公用品     |
+--------------+
8 rows in set (0.00 sec)
```
### 3.2 含有NULL值时的分组
示例：
```
mysql> SELECT pprice, COUNT(*) FROM pro             #COUNT(*)统计包含NULL的数据！
    -> GROUP BY pprice;
+--------+----------+
| pprice | COUNT(*) |
+--------+----------+
|     50 |        1 |
|    320 |        1 |
|   2800 |        2 |
|   5000 |        1 |
|   NULL |        2 |
|    790 |        1 |
+--------+----------+
6 rows in set (0.00 sec)

mysql> SELECT pprice, COUNT(pprice) FROM pro 
    -> GROUP BY pprice;
+--------+---------------+
| pprice | COUNT(pprice) |
+--------+---------------+
|     50 |             1 |
|    320 |             1 |
|   2800 |             2 |
|   5000 |             1 |
|   NULL |             0 |
|    790 |             1 |
+--------+---------------+
6 rows in set (0.00 sec)
```
